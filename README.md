# 球面地图场景A和2D地图场景B实现

## 功能概述

本项目实现了两个场景的切换和交互：

### 场景A（球面地图场景）
- **瓦片选择**：鼠标点击球面上的瓦片进行选择
- **高亮显示**：选中的瓦片会有白色高亮提示
- **Start Game按钮**：
  - 鼠标悬停时按钮变亮
  - 鼠标按下时按钮变暗
  - 只有选择了瓦片后才能点击进入场景B

### 场景B（2D地图场景）
- **区块生成**：根据场景A中选择的瓦片特征生成对应的2D地图区块
- **智能地形生成**：
  - 陆地区域：水域比例极低（0.2-1%），主要是陆地地形
  - 海洋区域：水域比例很高（75-95%），主要是水域和少量岛屿
  - 邻接影响：邻近海洋的陆地区域水域稍多，邻近陆地的海洋区域水域稍少
  - 连续地形：使用全局噪声种子确保区块间地形衔接自然连续
- **摄像机控制**：
  - WASD/方向键：摄像机平移
  - 鼠标滚轮：摄像机缩放（50x50 - 150x150瓦片范围，初始100x100）
- **区块加载**：类似《我的世界》的世界加载机制，动态加载当前区块周围的区块
- **调试功能**：红色实线显示区块边界，方便调试和观察区块分布
- **场景切换**：M键在场景A和场景B之间切换

## 文件结构

```
Scripts/
├── main.py                 # 主程序入口
├── config.py              # 配置文件（场景设置、UI配置、2D地图配置）
├── planet_generator.py    # 行星生成器
├── visualizer.py          # 球面地图场景A（增强版）
├── scene_manager.py       # 场景管理器
├── map_2d_generator.py    # 2D地图生成器
└── map_2d_scene.py        # 2D地图场景B
```

## 核心功能实现

### 1. 场景A功能
- **瓦片选择系统**：通过鼠标点击检测最接近的球面瓦片
- **高亮显示**：选中的瓦片用白色边框和背景高亮
- **交互式按钮**：支持悬停、按下状态的视觉反馈
- **生物群系识别**：根据瓦片颜色识别对应的生物群系

### 2. 场景B功能
- **智能区块生成**：
  - 海洋生物群系：生成较多水域（75-95%）
  - 陆地生物群系：生成极少水域（0.2-1%）
  - 全局噪声种子确保区块间连续性
- **摄像机系统**：
  - 初始位置位于区块中心
  - 平滑的平移和缩放
  - 缩放时瓦片大小的动态调整
- **动态区块加载**：
  - 加载半径：当前区块周围2个区块范围
  - 自动卸载不可见区块（内存优化）

### 3. 场景切换
- **无缝切换**：从场景A到场景B的平滑过渡
- **数据传递**：将选择的瓦片坐标和生物群系信息传递给场景B
- **返回功能**：ESC键返回场景A

## 技术特点

### 球面投影
- 使用球面坐标系统生成行星表面
- 支持鼠标点击到球面坐标的精确转换
- 实时光照效果

### 程序化生成
- 基于噪声的地形生成
- 生物群系相关的特征生成
- 保证邻接区块的连续性

### 性能优化
- 只渲染可见的区块
- 动态加载/卸载区块
- 批量处理球面点旋转

## 使用方法

1. **运行程序**：
   ```bash
   python Scripts/main.py
   ```

2. **场景A操作**：
   - 鼠标点击球面选择瓦片
   - 点击"Start Game"按钮进入场景B

3. **场景B操作**：
   - WASD/方向键：移动摄像机
   - 鼠标滚轮：缩放摄像机（50x50到150x150瓦片范围）
   - M键：切换到场景A
   - ESC：返回场景A
   - 红色实线：显示区块边界（调试用）

## 配置说明

主要配置在`config.py`中：

- **窗口设置**：屏幕尺寸、旋转速度
- **行星生成**：分辨率、噪声参数
- **UI设置**：按钮样式、颜色
- **2D地图设置**：区块大小、瓦片大小、瓦片类型
- **摄像机设置**：移动速度、缩放范围（基于瓦片数量）
- **调试设置**：区块边界显示开关

## 依赖库

- `pygame`：游戏引擎
- `numpy`：数值计算
- `noise`：程序化噪声生成

## 扩展性

系统设计具有良好的扩展性：

1. **新生物群系**：可在`config.py`中添加新的生物群系和对应的2D地形生成逻辑
2. **新瓦片类型**：可在2D地图生成器中添加新的瓦片类型
3. **新场景**：可通过场景管理器轻松添加新的场景类型
4. **新交互**：可在场景类中添加新的交互功能

## 实现状态

✅ **已完成功能**：
- 球面地图场景A的完整功能
- 2D地图场景B的完整功能
- 场景切换系统
- 区块生成和加载系统
- 摄像机控制系统
- UI交互系统

🎯 **核心特性**：
- 球面瓦片与2D区块的一一对应关系
- 基于生物群系的智能地形生成
- 类似《我的世界》的区块加载机制
- 流畅的场景切换体验
